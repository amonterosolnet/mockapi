<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Test GUI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .toast {
        position: fixed;
        top: 1rem;
        right: 1rem;
        max-width: 300px;
        z-index: 50;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }
      .toast.show {
        opacity: 1;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-8 flex flex-col min-h-screen">
      <!-- Centered Header -->
      <h1 class="text-3xl font-bold mb-8 text-center">Test API Endpoints</h1>

      <!-- Split Layout -->
      <div class="flex flex-grow">
        <!-- Left Column: API Endpoints -->
        <div class="flex-1 overflow-y-auto pr-4 space-y-6">
          <!-- Section for /api/direcciones -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/direcciones</h2>
            <label
              for="direccionesQuery"
              class="block font-medium text-gray-700"
              >Query:</label
            >
            <input
              type="text"
              id="direccionesQuery"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter query parameter (e.g., zamora)"
            />
            <button
              onclick="testEndpoint('/api/direcciones', 'GET', { q: document.getElementById('direccionesQuery').value })"
              class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/direcciones
            </button>
          </div>

          <!-- Section for /api/roles -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/roles</h2>
            <label for="rolesQuery" class="block font-medium text-gray-700"
              >Rol:</label
            >
            <input
              type="text"
              id="rolesQuery"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter rol (e.g., 279-10)"
            />
            <button
              onclick="testEndpoint('/api/roles', 'GET', { rol: document.getElementById('rolesQuery').value })"
              class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/roles
            </button>
          </div>

          <!-- Section for /api/propietarios -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/propietarios</h2>
            <label for="propietariosRut" class="block font-medium text-gray-700"
              >RUT:</label
            >
            <input
              type="text"
              id="propietariosRut"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter RUT without hyphen (e.g., 141783912)"
            />
            <button
              onclick="testEndpoint('/api/propietarios', 'POST', { rut: document.getElementById('propietariosRut').value })"
              class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/propietarios
            </button>
          </div>

          <!-- Section for /api/empresa -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/empresa</h2>
            <label for="empresaRut" class="block font-medium text-gray-700"
              >RUT:</label
            >
            <input
              type="text"
              id="empresaRut"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter RUT without hyphen (e.g., 14923165K)"
            />
            <button
              onclick="testEndpoint('/api/empresa', 'POST', { rut: document.getElementById('empresaRut').value })"
              class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/empresa
            </button>
          </div>

          <!-- Section for /api/representante -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/representante</h2>
            <label
              for="representanteRut"
              class="block font-medium text-gray-700"
              >RUT:</label
            >
            <input
              type="text"
              id="representanteRut"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter RUT without hyphen (e.g., 237911644)"
            />
            <button
              onclick="testEndpoint('/api/representante', 'POST', { rut: document.getElementById('representanteRut').value })"
              class="bg-teal-500 hover:bg-teal-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/representante
            </button>
          </div>

          <!-- Section for /api/arquitectos -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/arquitectos</h2>
            <label for="arquitectosRut" class="block font-medium text-gray-700"
              >RUT:</label
            >
            <input
              type="text"
              id="arquitectosRut"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter RUT without hyphen (e.g., 36816554)"
            />
            <button
              onclick="testEndpoint('/api/arquitectos', 'POST', { rut: document.getElementById('arquitectosRut').value })"
              class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/arquitectos
            </button>
          </div>

          <!-- Section for /api/address -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">/api/address</h2>
            <label for="addressDir" class="block font-medium text-gray-700"
              >Dirección:</label
            >
            <input
              type="text"
              id="addressDir"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter Dirección (e.g., SERAFIN ZAMORA)"
            />
            <label for="addressNum" class="block font-medium text-gray-700"
              >Número:</label
            >
            <input
              type="text"
              id="addressNum"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter Número (e.g., 54)"
            />
            <button
              onclick="testEndpoint('/api/address', 'POST', { dir: document.getElementById('addressDir').value, num: document.getElementById('addressNum').value })"
              class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Test /api/address
            </button>
          </div>
        </div>

        <!-- Right Column: API Key and Response -->
        <div class="flex-1 overflow-y-auto pl-4 space-y-6">
          <!-- API Key Input -->
          <div class="bg-white shadow-md rounded-lg p-6">
            <label for="apiKey" class="block font-medium text-gray-700"
              >API Key:</label
            >
            <input
              type="text"
              id="apiKey"
              class="mt-1 mb-4 p-2 border border-gray-300 rounded-md w-full"
              placeholder="Enter your API key"
            />
            <button
              onclick="storeApiKey()"
              class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded-md w-full"
            >
              Set API Key
            </button>
          </div>

          <!-- Toast Notification -->
          <div
            id="toast"
            class="toast bg-white text-gray-800 p-4 rounded-lg shadow-lg hidden"
          ></div>

          <!-- Response -->
          <div class="bg-white shadow-md rounded-lg p-6 flex-grow">
            <h2 class="text-xl font-semibold mb-4 text-center">Response:</h2>
            <pre
              id="response"
              class="p-4 bg-gray-100 border border-gray-300 rounded-lg overflow-auto h-64"
            ></pre>
          </div>
        </div>
      </div>
    </div>

    <script>
      let storedApiKey = '';

      function storeApiKey() {
        storedApiKey = document.getElementById('apiKey').value;
        showToast(
          'API Key has been set.',
          'bg-green-100 text-green-700 border-green-400'
        );
      }

      function showToast(message, classes) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast show ${classes}`;
        toast.classList.remove('hidden');
        setTimeout(() => {
          toast.classList.add('hidden');
          toast.classList.remove('show');
        }, 3000);
      }

      function testEndpoint(endpoint, method, params) {
        if (!storedApiKey) {
          showToast(
            'Please set the API Key first.',
            'bg-red-100 text-red-700 border-red-400'
          );
          return;
        }

        let url = `https://mockapi-rdmi.onrender.com${endpoint}`;
        const options = {
          method: method,
          headers: {
            'x-api-key': storedApiKey,
            'Content-Type': method === 'POST' ? 'application/json' : ''
          }
        };

        if (method === 'GET') {
          const queryParams = new URLSearchParams(params).toString();
          url += `?${queryParams}`;
        } else if (method === 'POST') {
          options.body = JSON.stringify(params);
        }

        fetch(url, options)
          .then((response) => response.json())
          .then((data) => {
            document.getElementById('response').textContent = JSON.stringify(
              data,
              null,
              2
            );
            showToast(
              'Request successful.',
              'bg-green-100 text-green-700 border-green-400'
            );
          })
          .catch((error) => {
            document.getElementById('response').textContent = 'Error: ' + error;
            showToast(
              'Request failed.',
              'bg-red-100 text-red-700 border-red-400'
            );
          });
      }
    </script>
  </body>
</html>
